<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Timer</title>
  <link rel="icon" href="img/favicon.ico">
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/font-awesome.css">
</head>
<body>
<div class="container">
<!--   <timer name="Chapter 1 - Light World"></timer>
  <hr>
  <timer name="Chapter 2 - Light World"></timer>
  <hr>
  <timer name="Chapter 3 - Light World"></timer>
 -->
  <alltimer>      </alltimer>
</div>
<!-- include extern librarys -->
<script src="js/superagent.js"></script>
<script src="js/riotux.js"></script>
<script src="js/riotrage.js"></script>

<!-- include components -->
<script src="components/timer.tag" type="riot/tag"></script>
<script src="components/allTimer.tag" type="riot/tag"></script>

<!-- include riot.js and the compiler -->
<script src="js/riot+compiler.js"></script>

<script type="text/javascript">
  riot.mount('*');
  
  const defaultTimerList = {
    theme: "SuperMeatBoy",
    timerList: [
      {id:'smbc1lw',name:'Chapter 1 - Light World',time:0,best:1337},
      {id:'smbc2lw',name:'Chapterz 2 - Light World',time:0,best:4223},
      {id:'smbc3lw',name:'Chapters 3 - Light World',time:0,best:644223},
    ]
  };

  let store = riotux.Store({
    state: {
      theme: 'SuperMeatBoy',
      allTime: 0,
      timerList: []
    },
    mutations: {
      loadTimerList: (state, themeName) => {
        let fromLocal = (themeName||false)? JSON.parse(localStorage.getItem(themeName)) : defaultTimerList;
        state.allTime = 0;
        state.theme = themeName;
        state.timerList = fromLocal.timerList;
      },
      saveTimerList: (state) => {
        let toLocal = JSON.stringify({theme:state.theme,timerList:state.timerList});
        localStorage.setItem(state.theme,toLocal);
      },
      updateById: (state, id, upObj) => {
        for(let s in state.timerList) {
          if(state.timerList[s].id===id) {
            for(let u in upObj) {
              state.timerList[s][u] = upObj[u];
            }
          break;
          }
        }
      },
      addAllTime: (state,timeToAdd) => {
        state.allTime+= timeToAdd;
      }
    }
  });


  let action = riotux.Actions({
    loadAll: (store, name) => {
      store.dispatch('loadTimerList', name);
    },
    saveAll: (store) => {
      store.dispatch('saveTimerList');
    },
    updateTimer: (store, updateObj) => {
      store.dispatch('updateObj', updateObj);
    }
    // getList: ( store, state ) => {
    //   if(state===undefined) return;
    //   let baseString = (state.search.base||false)? state.search.base : '';
    //   let searchText = encodeURIComponent(baseString + state.search.text);
    //   let urlString = '/search/key/'+state.search.limit+'/'+searchText;
    //   superagent('get',urlString).then( (res) => {
    //     store.dispatch('setKVlist', res.body);
    //     console.log("read kvlist done !!!");
    //   });
    // },
    // getBaseList: (store, state, searchString) => {
    //   let urlString = '/search/key/'+state.search.limit+'/'+encodeURIComponent(searchString);
    //   superagent('get',urlString).then( (res) => {
    //     store.dispatch('setBaseListMatrix', res.body);
    //   });
    // }
  });
  // riotux.action('timerList', 'saveAll');
  riotux.action('timerList', 'loadAll');

</script>
</body>
</html>